<?xml version="1.0" encoding="utf-8" ?>
<configuration>
  <configSections>
    <section name="atdi.platform" type="Atdi.Platform.ConfigElements.AtdiPlatformConfigElement, Atdi.Platform.Configurator" allowLocation="true" allowDefinition="Everywhere"/>
  </configSections>
  <startup> 
    <supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.7.2" />
  </startup>
  <runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <dependentAssembly>
        <assemblyIdentity name="Newtonsoft.Json" publicKeyToken="30ad4fe6b2a6aeed" culture="neutral"/>
        <bindingRedirect oldVersion="0.0.0.0-11.0.0.0" newVersion="11.0.0.0"/>
      </dependentAssembly>
    </assemblyBinding>
  </runtime>

  <connectionStrings>
    <add name="DB_SDRN_DeviceServer_ConnectionString" connectionString="Application Name=SDRN.DeviceServer;Server=192.168.33.110;Database=DB_SDRN_DeviceServer;UID=sa; PWD = P@ssw0rd;"/>

  </connectionStrings>
  
  <atdi.platform>

    <properties>
      <property name="SearchAssembliesStartPath" value="C:\Projects\Repos\atdi.ua\Dev\"/>
      <property name="SearchAssembliesPattern" value="\bin\Debug$"/>
      <property name="SearchAssembliesPattern_" value="\bin\Release$"/>
    </properties>

    <servicesContainer type="Atdi.Platform.ServicesContainer.Castle.WindsorServicesContainer, Atdi.Platform.ServicesContainer">
      <components>
        <component service="Atdi.Platform.IResourceResolver, Atdi.Platform" type="Atdi.Platform.DefaultResourceResolver, Atdi.Platform" lifetime="Singleton">
          <parameters>
            <parameter name="DefaultLang" value="en-us"/>
          </parameters>
        </component>
      </components>

    </servicesContainer>

    <installers>

      <install type="Atdi.Platform.Logging.LoggerInstaller, Atdi.Platform.Logging">
        <parameters>
          <parameter name="EventsCapacity" value="20000"/>
          <parameter name="Levels_" value="Trace"/>
        </parameters>
      </install>

      <install type="Atdi.Platform.Logging.EventsConsumers.ConsoleEventsConsumerInstaller, Atdi.Platform.Logging">
        <parameters>
          <parameter name="EventsCapacity" value="5000"/>
          <parameter name="Levels" value=""/>
          <parameter name="Contexts_" value="SQL Server Engine"/>
          <parameter name="Categories_" value="Executing command"/>
        </parameters>
      </install>

      <!--

      <install type="Atdi.Platform.Logging.EventsConsumers.FileEventsConsumerInstaller, Atdi.Platform.Logging">
        <parameters>
          <parameter name="Levels" value="" />
          <parameter name="Contexts_" value="SQL Server Engine" />
          <parameter name="Categories_" value="Executing command" />
        </parameters>
      </install>

      <install type="Atdi.Platform.Logging.EventsConsumers.FileEventsConsumerInstaller, Atdi.Platform.Logging">
        <parameters>
          <parameter name="FolderPath" value="C:\Temp\Logs" />
          <parameter name="FilePrefix" value="sql_" />
          <parameter name="Levels" value="" />
          <parameter name="Contexts" value="SQL Server Engine" />
          <parameter name="Categories" value="Executing command" />
        </parameters>
      </install>
-->
      <install type="Atdi.Platform.AppServer.ServerInstaller, Atdi.Platform.AppServer">
      </install>

    </installers>

    <appServer instance="SdrnDeviceAppServer">

      <properties>
        <property name="ThreadPoolSize" value="500"/>
      </properties>

      <components>
        <!-- Entity ORM -->
        
        <component type="EntityOrmCoreServices" assembly="Atdi.CoreServices.EntityOrm">
          <parameters>
            <parameter name="EnvironmentFileName" value="Metadata/Environment.xml"/>
          </parameters>
        </component>

        <!-- Data Layer with Data Context -->
        
        <component type="DataLayerCoreServices" assembly="Atdi.CoreServices.DataLayer">
          <parameters>
            <parameter name="DataContexts" value="{name=SDRN_DeviceServer_DB, dataEngine=SqlServer, connectionStringConfig=DB_SDRN_DeviceServer_ConnectionString}"/>

          </parameters>
        </component>

        <!-- Device Server Core: Controller -->
        
        <component type="SdrnDeviceServerAppUnit" assembly="Atdi.AppUnits.Sdrn.DeviceServer">
          <parameters>
            <parameter name="License.FileName" value="LIC-DBD12-A00-187.SENSOR-DBD12-A00-1280.lic"/>
            <parameter name="License.OwnerId" value="EAAAAGx8S55ZQpAiyIdWRRhYJVvpeZlErne1qujf3hgqK8F3t5+txQdxaxQEkfvKGbHUxA=="/>
            <parameter name="License.ProductKey" value="EAAAAM18Ot6mp2YmQkLMoNQbpGSU6VndtHM9RU0lMIvQtxXqZTam5RzF9vMZWMGSt3Br1g=="/>

            <parameter name="RabbitMQ.Host" value="192.168.33.110"/>
            <parameter name="RabbitMQ.Port" value=""/>
            <parameter name="RabbitMQ.VirtualHost" value="/"/>
            <parameter name="RabbitMQ.User" value="andrey"/>
            <parameter name="RabbitMQ.Password" value="EAAAACQE7YheyNO702XPzuu7gzYnHnwz6PM2VvtA1r6rc+AO"/>

            <parameter name="SDRN.ApiVersion" value="2.0"/>
            <parameter name="SDRN.Server.Instance" value="SDRNSV-SBD12-A00-8591"/>
            <parameter name="SDRN.Server.QueueNamePart" value="Q.SDRN.Server"/>
            <parameter name="SDRN.Device.SensorTechId" value="BB60C"/>
            <parameter name="SDRN.Device.Exchange" value="EX.SDRN.Device"/>
            <parameter name="SDRN.Device.QueueNamePart" value="Q.SDRN.Device"/>
            <parameter name="SDRN.Device.MessagesBindings" value="{messageType=RegisterSensor, routingKey=#01};{messageType=SendCommandResult, routingKey=#02};{messageType=SendMeasResults, routingKey=#03};{messageType=SendEntity, routingKey=#04};{messageType=SendEntityPart, routingKey=#05};{messageType=UpdateSensor, routingKey=#06}"/>
            <parameter name="SDRN.MessageConvertor.UseEncryption" value="false"/>
            <parameter name="SDRN.MessageConvertor.UseCompression" value="false"/>
          </parameters>
        </component>

        <!-- Device Server Core: Processing -->
        
        <component type="SdrnDeviceServerProcessingAppUnit" assembly="Atdi.AppUnits.Sdrn.DeviceServer.Processing">
          <parameters>
          </parameters>
        </component>

        <!-- Device Server Aplication: Messages handlers -->
        
        <component type="SdrnDeviceServerMessagingAppUnit" assembly="Atdi.AppUnits.Sdrn.DeviceServer.Messaging">
          <parameters>
          </parameters>
        </component>


        <!-- Device Server Aplication: Adapters -->
        
        <component type="SdrnDeviceServerExampleAdapterAppUnit" assembly="Atdi.AppUnits.Sdrn.DeviceServer.Adapters.ExampleAdapter">
          <parameters>
            <parameter name="Prop1" value="1"/>
            <parameter name="Prop2" value="2"/>
            <parameter name="Prop3" value="3"/>
            <parameter name="Prop4" value="4"/>
            <parameter name="Prop5" value="5"/>
          </parameters>
        </component>
        <component type="SdrnDeviceServerSignalHoundAppUnit" assembly="Atdi.AppUnits.Sdrn.DeviceServer.Adapters.SignalHound">
          <parameters>
          </parameters>
        </component>
        <component type="SdrnDeviceServerSpectrumAnalyzerAppUnit" assembly="Atdi.AppUnits.Sdrn.DeviceServer.Adapters.SpectrumAnalyzer">
          <parameters>
            <parameter name="SomeProperty" value="Value"/>
          </parameters>
        </component>

        <!-- Device Server Aplication: Processing (Workers and Result handlers) -->
        
        <component type="SdrnDeviceServerProcessingExampleAppUnit" assembly="Atdi.AppUnits.Sdrn.DeviceServer.Processing.Example">
          <parameters>
            <parameter name="SomeProperty" value="Value"/>
          </parameters>
        </component>

      </components>
    </appServer>

  </atdi.platform>
</configuration>